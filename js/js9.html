<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script>
    /*
    
    1、闭包：但凡内部函数被保存到外部，必定生成闭包
       例如1：
            function a() {
                function b() {
                    var bbb = 234;
                    console.log(aaa);
                }
                var aaa = 123;
                return b;  // 将内部函数保存到外部
            }
            var glob = 100;
            var demo = a();
            demo();
        例如2：
            function a() {
                var num = 100;
                function b() {
                    num ++;
                    console.log(num);
                }
                return b;
            } 
            var demo = a();
            demo();
            demo();

    2、闭包危害：当内部函数被包存到外部时，将会生成闭包。
                闭包会导致原有作用域链不释放，造成内存泄漏（表示会占用更多内存）。

    3、闭包作用：
        （1）实现共有变量
            eg:函数累加器：不依赖于外部变量
            function add() {
                 var count = 0;
                function demo() {
                    count ++;
                    console.log(count);
                }
                return demo;
            }
            var counter = add();
            counter();
        （2）可以做缓存（存储结构）
            eg1:
                function test() {
                    var num = 100;
                    function a() {
                        num ++;
                        console.log(num);
                    }
                    function b() {
                        num --;
                        console.log(num);
                    }
                    return [a, b];
                }
                var myArr = test();
                myArr[0]();
                // a doing     a.[[scope]]  0: aAO
                                            1: testAO
                                            2: GO
                myArr[1]();
                // b doing     b.[[scope]]  0: bAO
                                            1: testAO
                                            2: GO

            eg2: 同时返回多个函数，可以用对象存储来返回
                function eater() {
                    var food = "";
                    var obj = {
                        eat: function () {
                            console.log("i am eating" + food);
                        },
                        push: function (myFood) {
                            food = myFood;
                        }
                    }
                    return obj;
                }
                var eater1 = eater();
                eater1.push('banana');
                eater1.eat();
        （3）可以实现封装，属性私有化
            eg:Person()

        （4）模块化开发，防止污染全局变量；



    4、立即执行函数
        
        （1）有些函数只执行一次，就返回结果：针对初始化功能的函数

        （2）立即执行函数执行完就立即被销毁
        eg1:
            (function () {
                var a = 123;
                var b = 234;
                console.log(a + b);
            }

        eg2:
            var num = (function (a, b, c) {
                var d = a + b + c;
                return d;
            }(1, 2, 3));
        
        （3）立即执行函数的写法：
            写法一：
                (function (){}()); // 建议使用第一种
            
            写法二：
                (function (){})();

        （4）只有表达式才能被执行符号执行。
            执行符号：()   括号                                                                                  
            表达式：只要是一个式子就是一个表达式，哪怕只是一个数。
            
        （5）被执行符号执行的表达式就类似于立即执行函数，函数就会被释放；
            var test = function () {
                console.log('表达式');
            }();
            // 输出 表达式

            test();  // 输出 undefined
            

            eg1:
                + function test() {
                    console.log('a');
                }();   // 输出  a

                当上面的执行完之后再访问test，会报错；

                var demo = function () {
                    console.log('a');
                }();
                console.log(demo);   // 输出 undefined

                function test() {
                    console.log('a');
                }();   // 报错，因为不是表达式

                表达式：- / + / = / ! / || / && / () 等
                        有运算符的都是表达式

            eg2: 
                 var a = 'a';
                 console.log(+a);
                 // 输出 NaN  ，类型转换

            eg3:
                function test(a, b, c, d) {
                    console.log(a + b + c + d);
                }();
                // 报错

                function test(a, b, c, d) {
                    console.log(a + b + c + d);
                }(1, 2, 3, 4);
                // 不报错，但也不执行，没有意义

                原因： ()表示执行符号
                       (1, 2, 3, 4)加上参数，系统会识别成别的符号，尽量不报错。

                系统会转换成：（将函数声明和(1, 2, 3)分离，就不会报错了）
                    function test(a, b, c, d) {
                        console.log(a + b + c + d);
                    }
                    
                    (1, 2, 3, 4);
    */   
    var str = (function test () {
        return 1;
    }());
    </script>
</body>
</html>